!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).zenfi=t()}(this,function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,n={exports:{}},r={exports:{}};function o(){return t||(t=1,function(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports}(r)),r.exports}var i,u,a={exports:{}},c={exports:{}};function s(){return i||(i=1,function(e){function t(n,r,o,i){var u=Object.defineProperty;try{u({},"",{})}catch(n){u=0}e.exports=t=function(e,n,r,o){if(n)u?u(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r;else{var i=function(n,r){t(e,n,function(e){return this._invoke(n,r,e)})};i("next",0),i("throw",1),i("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,o,i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(c)),c.exports}function f(){return u||(u=1,function(e){var t=s();function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var r,o,i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function c(e,n,i,u){var a=n&&n.prototype instanceof f?n:f,c=Object.create(a.prototype);return t(c,"_invoke",function(e,t,n){var i,u,a,c=0,f=n||[],p=!1,l={p:0,n:0,v:r,a:h,f:h.bind(r,4),d:function(e,t){return i=e,u=0,a=r,l.n=t,s}};function h(e,t){for(u=e,a=t,o=0;!p&&c&&!n&&o<f.length;o++){var n,i=f[o],h=l.p,d=i[2];e>3?(n=d===t)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=r):i[0]<=h&&((n=e<2&&h<i[1])?(u=0,l.v=t,l.n=i[1]):h<d&&(n=e<3||i[0]>t||t>d)&&(i[4]=e,i[5]=t,l.n=d,u=0))}if(n||e>1)return s;throw p=!0,t}return function(n,f,d){if(c>1)throw TypeError("Generator is already running");for(p&&1===f&&h(f,d),u=f,a=d;(o=u<2?r:a)||!p;){i||(u?u<3?(u>1&&(l.n=-1),h(u,a)):l.n=a:l.v=a);try{if(c=2,i){if(u||(n="next"),o=i[n]){if(!(o=o.call(i,a)))throw TypeError("iterator result is not an object");if(!o.done)return o;a=o.value,u<2&&(u=0)}else 1===u&&(o=i.return)&&o.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+n+"' method"),u=1);i=r}else if((o=(p=l.n<0)?a:e.call(t,l))!==s)break}catch(e){i=r,u=1,a=e}finally{c=1}}return{value:o,done:p}}}(e,i,u),!0),c}var s={};function f(){}function p(){}function l(){}o=Object.getPrototypeOf;var h=[][u]?o(o([][u]())):(t(o={},u,function(){return this}),o),d=l.prototype=f.prototype=Object.create(h);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,t(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return p.prototype=l,t(d,"constructor",l),t(l,"constructor",p),p.displayName="GeneratorFunction",t(l,a,"GeneratorFunction"),t(d),t(d,a,"Generator"),t(d,u,function(){return this}),t(d,"toString",function(){return"[object Generator]"}),(e.exports=n=function(){return{w:c,m:v}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}(a)),a.exports}var p,l,h,d={exports:{}},v={exports:{}},y={exports:{}};function x(){return p||(p=1,function(e){var t=o(),n=s();e.exports=function e(r,o){function i(e,n,u,a){try{var c=r[e](n),s=c.value;return s instanceof t?o.resolve(s.v).then(function(e){i("next",e,u,a)},function(e){i("throw",e,u,a)}):o.resolve(s).then(function(e){c.value=e,u(c)},function(e){return i("throw",e,u,a)})}catch(e){a(e)}}var u;this.next||(n(e.prototype),n(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),n(this,"_invoke",function(e,t,n){function r(){return new o(function(t,r){i(e,n,t,r)})}return u=u?u.then(r,r):r()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports}(y)),y.exports}function m(){return l||(l=1,function(e){var t=f(),n=x();e.exports=function(e,r,o,i,u){return new n(t().w(e,r,o,i),u||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports}(v)),v.exports}function w(){return h||(h=1,function(e){var t=m();e.exports=function(e,n,r,o,i){var u=t(e,n,r,o,i);return u.next().then(function(e){return e.done?e.value:u.next()})},e.exports.__esModule=!0,e.exports.default=e.exports}(d)),d.exports}var b,g={exports:{}};function k(){return b||(b=1,function(e){e.exports=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports}(g)),g.exports}var _,O,j,P,S,E={exports:{}},T={exports:{}};function I(){return _||(_=1,function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(T)),T.exports}function N(){return O||(O=1,function(e){var t=I().default;e.exports=function(e){if(null!=e){var n=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(t(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports}(E)),E.exports}var D,M,U,C=function(){if(S)return P;S=1;var e=(j||(j=1,function(e){var t=o(),n=f(),r=w(),i=m(),u=x(),a=k(),c=N();function s(){var o=n(),f=o.m(s),p=(Object.getPrototypeOf?Object.getPrototypeOf(f):f.__proto__).constructor;function l(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))}var h={throw:1,return:2,break:3,continue:3};function d(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,h[e],t)},delegateYield:function(e,o,i){return t.resultName=o,n(r.d,c(e),i)},finish:function(e){return n(r.f,e)}},n=function(e,n,o){r.p=t.prev,r.n=t.next;try{return e(n,o)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(e.exports=s=function(){return{wrap:function(e,t,n,r){return o.w(d(e),t,n,r&&r.reverse())},isGeneratorFunction:l,mark:o.m,awrap:function(e,n){return new t(e,n)},AsyncIterator:u,async:function(e,t,n,o,u){return(l(t)?i:r)(d(e),t,n,o,u)},keys:a,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports}(n)),n.exports)();P=e;try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}return P}(),R=e(C),A={exports:{}};function z(){return D||(D=1,function(e){e.exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function t(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach(function(e){u(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function n(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,i){var u=e.apply(t,r);function a(e){n(u,o,i,a,c,"next",e)}function c(e){n(u,o,i,a,c,"throw",e)}a(void 0)})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c={exports:{}};
/*!
	         * JavaScript Cookie v2.2.1
	         * https://github.com/js-cookie/js-cookie
	         *
	         * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
	         * Released under the MIT license
	         */!function(e){var t;t=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var u=JSON.stringify(n);/^[\{\[]/.test(u)&&(n=u)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in i)i[c]&&(a+="; "+c,!0!==i[c]&&(a+="="+i[c].split(";")[0]));return document.cookie=t+"="+n+a}}function u(e,n){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],u=0;u<i.length;u++){var a=i[u].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var s=t(a[0]);if(c=(r.read||r)(c,s)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(o[s]=c,e===s)break}catch(e){}}return e?o[e]:o}}return o.set=i,o.get=function(e){return u(e,!1)},o.getJSON=function(e){return u(e,!0)},o.remove=function(t,n){i(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}(function(){})},e.exports=t()}(c);var s=c.exports,f=["element","value"],p="value",l="nativeValue",h="click",d="text",v={url:"https://api.zenfi.mx/products/leads/info",method:"GET"},y={url:"https://api.zenfi.mx/webhooks/leads/:partner/:type",method:"POST"},x={Accept:"application/json","Content-Type":"application/json"};function m(){return(m=r(R.mark(function e(t){var n,r,o,i,u,a;return R.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=v).url,o=n.method,i="".concat(r,"?token=").concat(t),e.next=4,fetch(i,{method:o,headers:x});case 4:return u=e.sent,e.next=7,u.json();case 7:if(a=e.sent,!u.ok){e.next=10;break}return e.abrupt("return",a.info||{});case 10:if(401!==u.status){e.next=12;break}throw new Error("UNAUTHORIZED");case 12:throw new Error(a.code);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}var w="zfid",b="zftoken",g=function(e){var t=e.domain,n="zenfi_id",r="zenfi_token",o=function(e){return s.get(e)},i=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:365;return s.set(e,n,{domain:t,expires:r,path:"/",secure:!0})};return{getId:function(){return o(n)},setId:function(e){return i(n,e)},getToken:function(){return o(r)},setToken:function(e){return i(r,e)},removeToken:function(e){return n=r,s.remove(n,{domain:t,path:"/"});var n},set:i,get:o}},k=function(e){var t=e.element,n=e.value,r=a(e,f).strategy||p;return r===p&&(t.value=n),r===l&&function(e,t){var n=Object.getOwnPropertyDescriptor(e,"value").set,r=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(r,"value").set;n&&n!==o?o.call(e,t):n.call(e,t)}(t,n),r===d&&(t.innerText=n),r===h&&t.click(),t},_=function(e){return document.querySelector(e)},O=function(e){return m.apply(this,arguments)},j=function(e){var t=e.meta,n=e.type,r=e.event,o=e.partner,i=e.zenfiId,u=y,a=u.url,c=u.method,s=a.replace(":type",n).replace(":partner",o),f={zenfiId:i,event:r,meta:t};return fetch(s,{method:c,headers:x,body:JSON.stringify(f)}).then(function(e){return e.json()})},P=function(e){var t=new URLSearchParams(e.search);return{id:t.get(w)||null,token:t.get(b)||null}},S=function(e){var t=new URL(e),n=new URLSearchParams(t.search);return n.delete(b),t.search=n.toString(),t.toString()},E=function(e){return null==e},T=function(e){return e&&"[object Function]"==={}.toString.call(e)},I=function(){var e="locationchange",t=window.history,n=t.pushState,r=t.replaceState;window.history.pushState=function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];var i=n.apply(window.history,r);return window.dispatchEvent(new Event(e)),i},window.history.replaceState=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=r.apply(window.history,n);return window.dispatchEvent(new Event(e)),i},window.addEventListener("popstate",function(){window.dispatchEvent(new Event(e))})};return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.partnerName,r=t.cookiesDomain,i=t.targets;o(this,e),this._id=null,this._token=null,this.leadInfo=null,this.partnerName=n,this.targets=i,this.cookies=g({domain:r}),this._handleUrlParams()}var n,u,a,c;return n=e,(u=[{key:"_handleUrlParams",value:function(){var e=P(location),t=e.id,n=e.token;t&&(this.id=t),n&&(this.token=n,history.replaceState(null,null,S(location.href)))}},{key:"id",get:function(){return this._id||(this._id=this.cookies.getId()),this._id},set:function(e){this._id=e||null,this.cookies.setId(this._id)}},{key:"token",get:function(){return this._token||(this._token=this.cookies.getToken()),this._token},set:function(e){this._token=e||null,this._token?this.cookies.setToken(this._token):this.cookies.removeToken()}},{key:"fetchData",value:(c=r(R.mark(function e(){return R.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.token){e.next=2;break}return e.abrupt("return",null);case 2:if(e.prev=2,this.leadInfo){e.next=7;break}return e.next=6,O(this.token);case 6:this.leadInfo=e.sent;case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),e.t0.message.includes("UNAUTHORIZED")&&(this.token=null);case 12:return e.abrupt("return",this.leadInfo);case 13:case"end":return e.stop()}},e,this,[[2,9]])})),function(){return c.apply(this,arguments)})},{key:"fillTargets",value:(a=r(R.mark(function e(){var n=this;return R.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchData();case 2:(this.targets||[]).forEach(function(e){var r=e||{},o=r.dataKey,i=r.strategy,u=r.beforeAction,a=r.afterAction,c=(n.leadInfo||{})[o];if(!E(c)){var s=T(e.selector)?e.selector({dataKey:o,strategy:i,value:c}):e.selector,f={value:c,selector:s,strategy:i},p=_(s);T(u)&&u(t(t({},f),{},{element:p})),(p=p||_(s))&&(p=k(t(t({},f),{},{element:p})),T(a)&&a(t(t({},f),{},{element:p})))}});case 3:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"trackEvent",value:function(e,t,n){if(!this.token)return null;if(!this.partnerName)throw new Error('Parameter "partnerName" is required to track events');return j({type:e,partner:this.partnerName,zenfiId:this.id,event:t,meta:n})}},{key:"trackConversion",value:function(e,t){this.trackEvent("converted",e,t)}},{key:"trackAbortion",value:function(e,t){this.trackEvent("aborted",e,t)}},{key:"trackPageView",value:function(){var e={href:window.location.href,hash:window.location.hash,search:window.location.search,protocol:window.location.protocol,hostname:window.location.hostname,pathname:window.location.pathname};this.trackConversion("PageView",e)}},{key:"initPageViewsTracking",value:function(){var e=this;this.trackPageView(),I(),window.addEventListener("locationchange",function(){return e.trackPageView()})}}])&&i(n.prototype,u),e}()}()}(A)),A.exports}return e(function(){if(U)return M;U=1;const e=new(z())({cookiesDomain:location.hostname.replace("www.",""),partnerName:"amex",targets:[]});return e.initPageViewsTracking(),M=e}())});
//# sourceMappingURL=index.js.map
